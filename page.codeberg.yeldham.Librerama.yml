app-id: page.codeberg.yeldham.Librerama
base: org.godotengine.godot.BaseApp
base-version: "3.5"
runtime: org.freedesktop.Platform
runtime-version: "21.08"  # Needs to match the version used by the Godot BaseApp
default-branch: stable
sdk: org.freedesktop.Sdk
command: librerama
rename-icon: icon

finish-args:
  - --share=ipc  # Required for X11 support
  - --socket=x11
  - --socket=pulseaudio
  - --device=all  # Required for joypad support. Only requesting "dri" would be the ideal

modules:
  - name: librerama
    buildsystem: simple

    sources:
      - type: script
        dest-filename: run.sh
        commands:
          - /app/bin/godot-runner --main-pack /app/bin/librerama.pck

      - type: file
        url: https://codeberg.org/attachments/abcb93d6-ff79-4185-bc36-423758970b0d
        sha256: 7bd3df7587c7dcd2c7af1e13756f511268d85a045495189e4d6bf221fb5c6d57
        dest-filename: "librerama.pck"

      - type: file
        url: https://codeberg.org/Yeldham/librerama/raw/tag/v0.6.0/icon.svg
        sha256: 5665030aa2ff2e774018034b15c909a7ba4bfee1e55eb70aa067f9aa328594de

      - type: file
        url: https://codeberg.org/Yeldham/librerama/raw/tag/v0.6.0/export/freedesktop/page.codeberg.yeldham.Librerama.desktop
        sha256: 9e9a9edf713fb1fba774b486be489639b56020c57376aa6295475081a73aeefa

      - type: file
        url: https://codeberg.org/Yeldham/librerama/raw/tag/v0.6.0/export/freedesktop/page.codeberg.yeldham.Librerama.appdata.xml
        sha256: ba64568b1381f8a9967c46a354abb3952e01f06aa83bba3d692b9fc289d0d539

      # Temporary. The upstream file will be fixed in the next update.
      - type: patch
        path: add_homepage_appdata.patch

    build-commands:
      - install -Dm755 run.sh /app/bin/librerama
      - install -Dm644 librerama.pck /app/bin/librerama.pck
      - install -Dm644 icon.svg -t /app/share/icons/hicolor/scalable/apps/
      - install -Dm644 page.codeberg.yeldham.Librerama.desktop -t /app/share/applications/
      - install -Dm644 page.codeberg.yeldham.Librerama.appdata.xml -t /app/share/appdata/
